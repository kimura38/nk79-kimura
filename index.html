<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simple Chat</title>

<style>
body {
  margin: 0;
  font-family: system-ui, sans-serif;
  background: #f2f2f2;
}
.screen {
  display: none;
  height: 100vh;
}
.screen.active {
  display: flex;
  flex-direction: column;
}
.center {
  justify-content: center;
  align-items: center;
}
input, button {
  font-size: 16px;
  padding: 10px;
  margin: 5px;
}
button {
  background: #06c755;
  color: white;
  border: none;
  border-radius: 6px;
}
</style>
</head>

<body>

<!-- åˆæœŸè¨­å®šç”»é¢ -->
<div id="setup" class="screen center">
  <h2>åå‰ã‚’å…¥åŠ›</h2>
  <input id="nameInput" placeholder="åå‰">
  <button onclick="saveName()">ã¯ã˜ã‚ã‚‹</button>
</div>

<!-- ãƒˆãƒ¼ã‚¯ä¸€è¦§ï¼ˆä»®ï¼‰ -->
<div id="home" class="screen">
  <h2 style="padding:10px">ãƒˆãƒ¼ã‚¯ä¸€è¦§ï¼ˆæº–å‚™ä¸­ï¼‰</h2>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

/* ğŸ”‘ Firebaseè¨­å®šï¼ˆãã®ã¾ã¾ä½¿ã£ã¦OKï¼‰ */
const firebaseConfig = {
  apiKey: "AIzaSyCQNNj6Ff39wECAI6i8n1f2NXstF2k7duo",
  authDomain: "chat-99077.firebaseapp.com",
  databaseURL: "https://chat-99077-default-rtdb.firebaseio.com",
  projectId: "chat-99077",
  storageBucket: "chat-99077.firebasestorage.app",
  messagingSenderId: "991554319310",
  appId: "1:991554319310:web:a662919d90bc014e06319f"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* ãƒ¦ãƒ¼ã‚¶ãƒ¼IDç”Ÿæˆ */
function uuid() {
  return 'xxxxxx'.replace(/x/g, () =>
    Math.floor(Math.random() * 36).toString(36)
  );
}

/* åˆæœŸè¡¨ç¤º */
const userId = localStorage.getItem("userId");
if (userId) {
  show("home");
} else {
  show("setup");
}

window.saveName = () => {
  const name = nameInput.value.trim();
  if (!name) return alert("åå‰ã‚’å…¥åŠ›ã—ã¦");

  const id = uuid();
  localStorage.setItem("userId", id);
  localStorage.setItem("name", name);

  set(ref(db, "users/" + id), {
    name: name,
    created: Date.now()
  });

  show("home");
};

function show(id) {
  document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}
</script>

</body>
</html>
