<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>2Dアクション</title>
<style>
  body { margin:0; background:black; }
  canvas { display:block; margin:auto; background:#5c94fc; }
</style>
</head>
<body>

<canvas id="game" width="480" height="270"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let scene = "title";

// プレイヤー
const player = {
  x: 50,
  y: 0,
  w: 24,
  h: 24,
  vx: 0,
  vy: 0,
  onGround: false
};

// 地面・足場
const platforms = [
  {x:0, y:240, w:480, h:30},
  {x:120, y:180, w:80, h:10},
  {x:260, y:140, w:80, h:10}
];

const GRAVITY = 0.6;
const JUMP = -10;
const SPEED = 3;

// タップ操作
canvas.addEventListener("touchstart", e => {
  if (scene === "title") {
    scene = "game";
    reset();
    return;
  }
  const x = e.touches[0].clientX - canvas.getBoundingClientRect().left;
  if (x < canvas.width / 2) player.vx = -SPEED;
  else player.vx = SPEED;
});

canvas.addEventListener("touchend", () => {
  player.vx = 0;
  if (player.onGround) player.vy = JUMP;
});

// リセット
function reset() {
  player.x = 50;
  player.y = 0;
  player.vx = 0;
  player.vy = 0;
}

// 当たり判定
function hit(a,b){
  return a.x < b.x+b.w && a.x+a.w > b.x &&
         a.y < b.y+b.h && a.y+a.h > b.y;
}

// ゲーム更新
function update(){
  if (scene !== "game") return;

  player.vy += GRAVITY;
  player.x += player.vx;
  player.y += player.vy;
  player.onGround = false;

  platforms.forEach(p=>{
    if (hit(player,p) && player.vy > 0) {
      player.y = p.y - player.h;
      player.vy = 0;
      player.onGround = true;
    }
  });

  if (player.y > canvas.height) reset();
}

// 描画
function draw(){
  ctx.clearRect(0,0,480,270);

  if (scene === "title") {
    ctx.fillStyle="white";
    ctx.font="30px sans-serif";
    ctx.fillText("2D ACTION GAME", 90, 120);
    ctx.font="20px sans-serif";
    ctx.fillText("TAP TO START", 150, 160);
    return;
  }

  // 足場
  ctx.fillStyle="#654321";
  platforms.forEach(p=>{
    ctx.fillRect(p.x,p.y,p.w,p.h);
  });

  // プレイヤー
  ctx.fillStyle="red";
  ctx.fillRect(player.x,player.y,player.w,player.h);
}

function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>
