<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>2Dアクションゲーム</title>
<style>
  body { margin:0; background:black; }
  canvas { display:block; margin:auto; background:#5c94fc; }
</style>
</head>
<body>

<canvas id="game" width="480" height="270"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

// ================== 状態 ==================
let scene = "title";
let language = "jp";   // jp / en
let control = "touch"; // touch / button

// ================== テキスト ==================
const TEXT = {
  jp: {
    title: "2Dアクションゲーム",
    start: "スタート",
    settings: "設定",
    back: "もどる",
    language: "言語",
    control: "操作方法",
    touch: "タッチ",
    button: "ボタン"
  },
  en: {
    title: "2D Action Game",
    start: "START",
    settings: "SETTINGS",
    back: "BACK",
    language: "LANGUAGE",
    control: "CONTROL",
    touch: "TOUCH",
    button: "BUTTON"
  }
};

// ================== プレイヤー ==================
const player = {
  x: 50, y: 0, w: 24, h: 24,
  vx: 0, vy: 0, onGround: false
};

const platforms = [
  {x:0,y:240,w:480,h:30},
  {x:140,y:180,w:80,h:10},
  {x:280,y:140,w:80,h:10}
];

const GRAVITY = 0.6, SPEED = 3, JUMP = -10;

// ================== 入力 ==================
canvas.addEventListener("touchstart", e=>{
  const r = canvas.getBoundingClientRect();
  const x = e.touches[0].clientX - r.left;
  const y = e.touches[0].clientY - r.top;

  // タイトル
  if (scene === "title") {
    if (x > 400 && y < 40) scene = "settings";
    else { scene = "game"; reset(); }
    return;
  }

  // 設定
  if (scene === "settings") {
    if (y > 80 && y < 110) language = language === "jp" ? "en" : "jp";
    if (y > 130 && y < 160) control = control === "touch" ? "button" : "touch";
    if (y > 200) scene = "title";
    return;
  }

  // ゲーム
  if (control === "touch") {
    if (x < canvas.width/2) player.vx = -SPEED;
    else player.vx = SPEED;
  }
});

canvas.addEventListener("touchend", ()=>{
  if (scene === "game" && control === "touch") {
    player.vx = 0;
    if (player.onGround) player.vy = JUMP;
  }
});

// ================== 処理 ==================
function reset(){
  player.x = 50; player.y = 0;
  player.vx = 0; player.vy = 0;
}

function hit(a,b){
  return a.x < b.x+b.w && a.x+a.w > b.x &&
         a.y < b.y+b.h && a.y+a.h > b.y;
}

function update(){
  if (scene !== "game") return;

  player.vy += GRAVITY;
  player.x += player.vx;
  player.y += player.vy;
  player.onGround = false;

  platforms.forEach(p=>{
    if (hit(player,p) && player.vy > 0) {
      player.y = p.y - player.h;
      player.vy = 0;
      player.onGround = true;
    }
  });

  if (player.y > canvas.height) reset();
}

// ================== 描画 ==================
function draw(){
  ctx.clearRect(0,0,480,270);
  const T = TEXT[language];

  if (scene === "title") {
    ctx.fillStyle="white";
    ctx.font="28px sans-serif";
    ctx.fillText(T.title, 90, 120);
    ctx.font="18px sans-serif";
    ctx.fillText(T.start, 200, 160);

    // 設定ボタン
    ctx.font="16px sans-serif";
    ctx.fillText("⚙ " + T.settings, 380, 25);
    return;
  }

  if (scene === "settings") {
    ctx.fillStyle="white";
    ctx.font="20px sans-serif";
    ctx.fillText(T.settings, 200, 40);

    ctx.font="16px sans-serif";
    ctx.fillText(T.language + ": " + (language==="jp"?"日本語":"English"), 140, 100);
    ctx.fillText(T.control + ": " + (control==="touch"?T.touch:T.button), 140, 150);
    ctx.fillText("← " + T.back, 200, 220);
    return;
  }

  // ゲーム描画
  ctx.fillStyle="#654321";
  platforms.forEach(p=>ctx.fillRect(p.x,p.y,p.w,p.h));

  ctx.fillStyle="red";
  ctx.fillRect(player.x,player.y,player.w,player.h);
}

// ================== ループ ==================
function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>
