<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>本格ゲーム</title>
<style>
  body { margin: 0; background: black; }
  canvas { display: block; margin: auto; background: #222; }
</style>
</head>
<body>

<canvas id="game" width="400" height="600"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

// プレイヤー
const player = {
  x: 180,
  y: 500,
  w: 40,
  h: 40,
  speed: 5
};

// 敵
let enemies = [];
let score = 0;
let gameOver = false;

// タッチ操作（iPad対応）
canvas.addEventListener("touchmove", e => {
  const rect = canvas.getBoundingClientRect();
  player.x = e.touches[0].clientX - rect.left - player.w / 2;
});

// 敵を出す
function spawnEnemy() {
  enemies.push({
    x: Math.random() * 360,
    y: -40,
    w: 40,
    h: 40,
    speed: 3
  });
}

// 当たり判定
function hit(a, b) {
  return a.x < b.x + b.w &&
         a.x + a.w > b.x &&
         a.y < b.y + b.h &&
         a.y + a.h > b.y;
}

// メインループ
function loop() {
  if (gameOver) {
    ctx.fillStyle = "red";
    ctx.font = "40px sans-serif";
    ctx.fillText("GAME OVER", 70, 300);
    return;
  }

  ctx.clearRect(0, 0, 400, 600);

  // プレイヤー描画
  ctx.fillStyle = "cyan";
  ctx.fillRect(player.x, player.y, player.w, player.h);

  // 敵処理
  ctx.fillStyle = "orange";
  enemies.forEach(e => {
    e.y += e.speed;
    ctx.fillRect(e.x, e.y, e.w, e.h);

    if (hit(player, e)) gameOver = true;
  });

  // スコア
  score++;
  ctx.fillStyle = "white";
  ctx.font = "20px sans-serif";
  ctx.fillText("SCORE: " + score, 10, 30);

  requestAnimationFrame(loop);
}

// 敵出現
setInterval(spawnEnemy, 800);

loop();
</script>

</body>
</html>
